<!DOCTYPE html>
<html lang="kr" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.104.1" />
    <meta name="description" content="COM2018 OOP Class Lecture Note">
<meta name="author" content="Soo Young Kim">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Lecture5 - ROS 2 Topic and Examples - Documentation for Hugo Learn Theme</title>

    
    <link href="/css/nucleus.css?1682980326" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1682980326" rel="stylesheet">
    <link href="/css/hybrid.css?1682980326" rel="stylesheet">
    <link href="/css/featherlight.min.css?1682980326" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1682980326" rel="stylesheet">
    <link href="/css/auto-complete.css?1682980326" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1682980326" rel="stylesheet">
    <link href="/css/theme.css?1682980326" rel="stylesheet">
    <link href="/css/tabs.css?1682980326" rel="stylesheet">
    <link href="/css/hugo-theme.css?1682980326" rel="stylesheet">
    
    <link href="/css/theme-green.css?1682980326" rel="stylesheet">
    
    <link href="/css/foo.css?1682980326" rel="stylesheet"><link href="/css/bar.css?1682980326" rel="stylesheet">

    <script src="/js/jquery-3.3.1.min.js?1682980326"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/kr/ros2_basic_foxy/lecture5/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img width="1097" alt="image" src="https://user-images.githubusercontent.com/12381733/209764275-05dcbdbf-cef7-47ad-94a6-6d61febad01e.png">
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1682980326"></script>
<script type="text/javascript" src="/js/auto-complete.js?1682980326"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/kr";
    
</script>
<script type="text/javascript" src="/js/search.js?1682980326"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/kr'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/kr/ros_basic_noetic/" title="ROS Basics" class="dd-item
        
        
        
        ">
      <a href="/kr/ros_basic_noetic/">
          <b>ROS Noetic. </b>ROS Basics
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture1/" title="Lecture1 - Introduction to ROS" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture1/">
        Lecture1 - Introduction to ROS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture2/" title="Lecture2 - Dev Env Setup" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture2/">
        Lecture2 - Dev Env Setup
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture3/" title="Lecture3 - Core of ROS" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture3/">
        Lecture3 - Core of ROS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture4/" title="Lecture4 - ROS Launch, RViz" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture4/">
        Lecture4 - ROS Launch, RViz
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture5/" title="Lecture5 - First Programming, ROS Topic" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture5/">
        Lecture5 - First Programming, ROS Topic
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture6/" title="Lecture6 - ROS Service, Parameter" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture6/">
        Lecture6 - ROS Service, Parameter
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture7/" title="Lecture7 - Rqt Tools and rosbag, ROS Time" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture7/">
        Lecture7 - Rqt Tools and rosbag, ROS Time
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture8/" title="Lecture8 - Deal with Open Source Projects, Custom Interfaces" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture8/">
        Lecture8 - Deal with Open Source Projects, Custom Interfaces
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture9/" title="Lecture9 - ROS TF and Examples" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture9/">
        Lecture9 - ROS TF and Examples
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_basic_noetic/lecture10/" title="Lecture10 - TF2 Examples, Outro" class="dd-item ">
        <a href="/kr/ros_basic_noetic/lecture10/">
        Lecture10 - TF2 Examples, Outro
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/kr/advanced_contents_ros1/" title="ROS" class="dd-item
        
        
        
        ">
      <a href="/kr/advanced_contents_ros1/">
          <b>Advanced Contents. </b>ROS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/kr/advanced_contents_ros1/lecture1/" title="Lecture1 - ROSCPP" class="dd-item ">
        <a href="/kr/advanced_contents_ros1/lecture1/">
        Lecture1 - ROSCPP
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/advanced_contents_ros1/lecture2/" title="Lecture2 - More About ROS System" class="dd-item ">
        <a href="/kr/advanced_contents_ros1/lecture2/">
        Lecture2 - More About ROS System
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/advanced_contents_ros1/lecture3/" title="Lecture3 - SROS" class="dd-item ">
        <a href="/kr/advanced_contents_ros1/lecture3/">
        Lecture3 - SROS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/kr/ros2_basic_foxy/" title="ROS 2 Basics" class="dd-item
        parent
        
        
        ">
      <a href="/kr/ros2_basic_foxy/">
          <b>[Old]ROS 2 Foxy. </b>ROS 2 Basics
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture1/" title="Lecture1 - Introduction to ROS 2" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture1/">
        Lecture1 - Introduction to ROS 2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture2/" title="Lecture2 - ROS 2 Node, Package" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture2/">
        Lecture2 - ROS 2 Node, Package
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture3/" title="Lecture3 - ROS 2 Node Programming, ROS 2 parameter" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture3/">
        Lecture3 - ROS 2 Node Programming, ROS 2 parameter
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture4/" title="Lecture4 - ROS 2 Node C&#43;&#43; Programming" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture4/">
        Lecture4 - ROS 2 Node C&#43;&#43; Programming
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture5/" title="Lecture5 - ROS 2 Topic and Examples" class="dd-item active">
        <a href="/kr/ros2_basic_foxy/lecture5/">
        Lecture5 - ROS 2 Topic and Examples
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture6/" title="Lecture6 - ROS 2 Service and Examples" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture6/">
        Lecture6 - ROS 2 Service and Examples
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture7/" title="Lecture7 - Useful ROS 2 Example, Navigation2" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture7/">
        Lecture7 - Useful ROS 2 Example, Navigation2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture8/" title="Lecture8 - ROS 2 Action and Examples" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture8/">
        Lecture8 - ROS 2 Action and Examples
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_basic_foxy/lecture9/" title="Lecture9 - C&#43;&#43; Programming Again, Outro" class="dd-item ">
        <a href="/kr/ros2_basic_foxy/lecture9/">
        Lecture9 - C&#43;&#43; Programming Again, Outro
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/kr/ros2_foxy/" title="ROS 2 Basics" class="dd-item
        
        
        
        ">
      <a href="/kr/ros2_foxy/">
          <b>[New]ROS 2 Foxy. </b>ROS 2 Basics
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture1/" title="Lecture1. What is ROS?" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture1/">
        Lecture1. What is ROS?
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture2/" title="Lecture2. Dev Env Setup" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture2/">
        Lecture2. Dev Env Setup
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture3/" title="Lecture3. Core of ROS" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture3/">
        Lecture3. Core of ROS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture4/" title="Lecture4. ROS 2 Node and Parameter Programming" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture4/">
        Lecture4. ROS 2 Node and Parameter Programming
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture5/" title="Lecture5. ROS 2 Communication Mechanisms" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture5/">
        Lecture5. ROS 2 Communication Mechanisms
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture6/" title="Lecture6. ROS 2 Tools" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture6/">
        Lecture6. ROS 2 Tools
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture7/" title="Lecture7. ROS 2 Topic and Programming" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture7/">
        Lecture7. ROS 2 Topic and Programming
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture8/" title="Lecture8. ROS 2 Service and Programming" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture8/">
        Lecture8. ROS 2 Service and Programming
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture9/" title="Lecture9. ROS 2 Action Programming" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture9/">
        Lecture9. ROS 2 Action Programming
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture10/" title="Lecture10. TF and ROS 2" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture10/">
        Lecture10. TF and ROS 2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture11/" title="Lecture11. About Gazebo - 1" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture11/">
        Lecture11. About Gazebo - 1
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture12/" title="Lecture12. About Gazebo - 2" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture12/">
        Lecture12. About Gazebo - 2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture13/" title="Lecture13. Useful ROS 2 Examples (Sensor Part)" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture13/">
        Lecture13. Useful ROS 2 Examples (Sensor Part)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture14/" title="Lecture14. Useful ROS 2 Examples (Control Part)" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture14/">
        Lecture14. Useful ROS 2 Examples (Control Part)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture15/" title="Lecture15. Advanced ROS 2, Package Management" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture15/">
        Lecture15. Advanced ROS 2, Package Management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture16/" title="Lecture16. Useful ROS 2 Examples (Misc)" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture16/">
        Lecture16. Useful ROS 2 Examples (Misc)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture17/" title="Lecture17" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture17/">
        Lecture17
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture18/" title="Lecture18. Point Cloud Deep Learning Example (PointNet)" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture18/">
        Lecture18. Point Cloud Deep Learning Example (PointNet)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture19/" title="Lecture19. NVIDIA Isaac Sim" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture19/">
        Lecture19. NVIDIA Isaac Sim
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros2_foxy/lecture20/" title="Lecture20. NVIDIA Jetson Platform" class="dd-item ">
        <a href="/kr/ros2_foxy/lecture20/">
        Lecture20. NVIDIA Jetson Platform
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/kr/advanced_contents_ros2/" title="ROS 2" class="dd-item
        
        
        
        ">
      <a href="/kr/advanced_contents_ros2/">
          <b>Advanced Contents. </b>ROS 2
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/kr/advanced_contents_ros2/lecture1/" title="Lecture1 - About DDS" class="dd-item ">
        <a href="/kr/advanced_contents_ros2/lecture1/">
        Lecture1 - About DDS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/advanced_contents_ros2/lecture2/" title="Lecture11 - About DDS (2)" class="dd-item ">
        <a href="/kr/advanced_contents_ros2/lecture2/">
        Lecture11 - About DDS (2)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/advanced_contents_ros2/lecture3/" title="Lecture12 - SROS2" class="dd-item ">
        <a href="/kr/advanced_contents_ros2/lecture3/">
        Lecture12 - SROS2
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/kr/ros_and_gazebo/" title="Gazebo and ROS" class="dd-item
        
        
        
        ">
      <a href="/kr/ros_and_gazebo/">
          <b>Gazebo. </b>Gazebo and ROS
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_and_gazebo/lecture1/" title="Lecture1 - Gazebo and Robot" class="dd-item ">
        <a href="/kr/ros_and_gazebo/lecture1/">
        Lecture1 - Gazebo and Robot
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/kr/ros_and_gazebo/lecture2/" title="Lecture2 - Gazebo and Robot(2)" class="dd-item ">
        <a href="/kr/ros_and_gazebo/lecture2/">
        Lecture2 - Gazebo and Robot(2)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/RB2023ROS/du2023-ros1"><i class='fab fa-fw fa-github'></i> GitHub repo - ROS 1</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/RB2023ROS/du2023-ros2"><i class='fab fa-fw fa-github'></i> GitHub repo - ROS 2</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="kr" value="/kr/ros2_basic_foxy/lecture5/" selected>Korean</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      

      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='' href="https://github.com/com2018-fa22/hugo-blog/tree/main/content/ros2_basic_foxy/lecture5.kr.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text"></span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Lecture5 - ROS 2 Topic and Examples
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#src-gazebo">SRC Gazebo</a></li>
        <li><a href="#ros-2-topic">ROS 2 Topic</a></li>
        <li><a href="#ros-2-topic-msg">ROS 2 Topic msg</a></li>
        <li><a href="#ros-2-topic-tools">ROS 2 Topic Tools</a></li>
        <li><a href="#ros-bridge">ROS Bridge</a></li>
        <li><a href="#my-gazebo-world">My Gazebo World</a></li>
      </ul>
    </li>
    <li><a href="#ros-2-topic-프로그래밍">ROS 2 Topic 프로그래밍</a>
      <ul>
        <li><a href="#example1---cmd_vel-publish">example1 - cmd_vel publish</a></li>
        <li><a href="#example2---scan-subscription">example2 - scan subscription</a></li>
        <li><a href="#example3---parking">example3 - parking</a></li>
        <li><a href="#cv-2-and-ros-2">CV 2 and ROS 2</a></li>
        <li><a href="#example1---cv-bridge">Example1 - CV Bridge</a></li>
        <li><a href="#rosbag-to-img">rosbag to img</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Lecture5 - ROS 2 Topic and Examples
            </h1>
          

        


<blockquote>
<p>Topic에 대해 배워보기 전에, 실습 시스템을 구축해봅시다.</p>
</blockquote>
<h3 id="src-gazebo">SRC Gazebo</h3>
<blockquote>
<p>이번 ROS 2 강의의 실습들은 Road Balance의 차량형 로봇 SRC를 통해 진행하고자 합니다. 실습을 진행하기 전 Gazebo 환경을 함께 세팅해보겠습니다.</p>
</blockquote>
<ul>
<li>src_gazebo 실행 세팅 - 다소 번거로운 작업이므로 gif를 보시면서 차근차근 잘 따라와주세요!</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd ~/ros2_ws/src/du2023-ros2
</span></span><span style="display:flex;"><span>./setup_scripts.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CMakeLists.txt 수정 (주석)</span>
</span></span><span style="display:flex;"><span>colcon build --packages-select src_gazebo
</span></span><span style="display:flex;"><span>source install/local_setup.bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CMakeLists.txt 수정 (주석 해제)</span>
</span></span><span style="display:flex;"><span>colcon build --packages-select src_gazebo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>colcon build --packages-select src_odometry
</span></span><span style="display:flex;"><span>colcon build --packages-select src_controller
</span></span><span style="display:flex;"><span>source install/local_setup.bash
</span></span></code></pre></div><p><img src="/kr/ros2_basic_foxy/images5/src_urdf.gif?height=500px" alt="src_urdf.gif"></p>
<ul>
<li>empty world 실행</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ros2 launch src_gazebo empty_world<span style="color:#f92672">.</span>launch<span style="color:#f92672">.</span>py
</span></span></code></pre></div><ul>
<li>빈 gazebo 환경에 차량형 로봇이 등장할 것입니다. 함께 등장하는 <strong>rqt_robot_steering</strong>을 통해 로봇을 움직여보세요.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/src_turn.gif?height=400px" alt="src_turn.gif"></p>
<ul>
<li>실행 중 발생할 수 있는 오류와 해결방법을 제시드립니다. 아래와 같은 에러 발생 시 <code>sudo apt dist-upgrade</code>를 입력하면 됩니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_0.png?height=100px" alt="lec5_0.png"></p>
<blockquote>
<p>로봇에 부착되어 있는 센서 데이터들과 제어 데이터를 <strong>ros2 topic list</strong>로 확인해봅시다.</p>
</blockquote>
<ul>
<li><strong>/cmd_vel</strong> : Twist msg를 통해 로봇을 제어하는 topic</li>
<li><strong>/imu/data</strong> : imu 데이터</li>
<li><strong>/scan</strong> : 2D lidar</li>
<li><strong>/logi_camera_sensor/image_raw</strong> : 전방 카메라 데이터</li>
</ul>
<h3 id="ros-2-topic">ROS 2 Topic</h3>
<blockquote>
<p>강의를 열심히 따라오면서 ROS 개념을 잊어버렸을 수도 있으므로 간단히 개념 복습을 해보겠습니다.</p>
</blockquote>
<ul>
<li>Topic은 Node들 사이에 데이터(Message)가 오가는 길(Bus)의 이름이며, 적절한 이름으로 데이터를 송수신하지 않으면 원하는 동작을 수행할 수 없습니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/topic.gif?height=300px" alt="topic.gif"></p>
<p>image from : <a href="https://docs.ros.org/en/foxy/Tutorials/Topics/Understanding-ROS2-Topics.html">docs.ros.org</a></p>
<ul>
<li>Topic의 중요한 특징으로 Topic은 여러 Node들로부터 데이터를 받을 수 있고, 전송 시에도 여러 Node들에게 전송이 가능한 방식입니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/topic2.gif?height=300px" alt="topic2.gif"></p>
<ul>
<li>image from : <a href="https://docs.ros.org/en/foxy/Tutorials/Topics/Understanding-ROS2-Topics.html">docs.ros.org</a></li>
</ul>
<blockquote>
<p>topic을 통해 데이터가 전달되는 과정은 다음과 같습니다.</p>
</blockquote>
<ul>
<li>데이터를 보내는 주체인 <strong>publisher</strong>는 topic을 통해 원하는 정보를 <strong>subscriber</strong>에게 전달합니다. 이것을 <strong>topic publish</strong>라고 부르지요.</li>
<li>반대로, 데이터를 받는 주체인 <strong>subscriber</strong> 입장에선 topic을 통해 데이터를 받게 되며 이것은 <strong>topic subscribe</strong>라고 불립니다.</li>
</ul>
<h3 id="ros-2-topic-msg">ROS 2 Topic msg</h3>
<blockquote>
<p>로봇 프로그래밍 시 센서, 제어 데이터를 비롯하여 다양한 유형의 데이터들이 Topic을 통해 오고 갑니다. ROS에서는 이러한 데이터 형식을 <strong>msg - Message</strong>라는 형태로 제공하며, 원하는 데이터에 적합한 topic msg를 사용하면 더욱 효율적인 로봇 프로그래밍이 가능해집니다.</p>
</blockquote>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_1.png?height=300px" alt="lec5_1.png"></p>
<ul>
<li>image from : <a href="https://ethz.ch/content/dam/ethz/special-interest/mavt/robotics-n-intelligent-systems/rsl-dam/ROS2021/lec4/ROS%20Course%20Slides%20Course%204.pdf">ethz.ch</a></li>
</ul>
<p>geometry_msgs/Twist와 같은 message는 ROS 2에서도 동일하게 사용할 수 있습니다. 다만, ROS 2에서는 msg/srv/action 과 같이 필드의 구분이 하나 더 추가됩니다.</p>
<ul>
<li><strong>ROS 1 : geometry_msgs/Twist</strong></li>
<li><strong>ROS 2 : geometry_msgs/msg/Twist</strong></li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_2.png?height=300px" alt="lec5_2.png"></p>
<ul>
<li>출처 : <a href="http://docs.ros.org/en/melodic/api/geometry_msgs/html/msg/Twist.html">http://docs.ros.org/</a></li>
</ul>
<p>특정 message가 어떻게 구성되어 있는지 알고 싶을 때는 다음과 같은 커멘드 라인을 사용합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ros2 interface show geometry_msgs/msg/Twist
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This expresses velocity in free space broken into its linear and angular parts.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Vector3  linear
</span></span><span style="display:flex;"><span>Vector3  angular
</span></span></code></pre></div>
<div class="notices note" ><p>혹은 앞서 제가 살펴본 것 처럼 검색을 해 보아도 됩니다.</p>
</div>

<p>ROS 2로 넘어오면서, topic 커멘드들은 다음과 같이 살짝 바뀌었습니다.</p>
<ul>
<li><strong>rostopic list ⇒ ros2 topic list</strong></li>
<li><strong>rostopic info ⇒ ros2 topic info</strong></li>
<li><strong>rostopic echo ⇒ ros2 topic echo</strong></li>
</ul>
<h3 id="ros-2-topic-tools">ROS 2 Topic Tools</h3>
<blockquote>
<p>ROS 2에서도 GUI툴 RQT를 사용할 수 있습니다. Topic과 관련된 rqt tools들을 사용해봅시다.</p>
</blockquote>

<div class="notices note" ><p>ROS 1과 ROS 2의 rqt는 다른 프로그램이며 ROS 1의 plugin과 ROS 2의 plugin이 완전 동일하지는 않습니다.</p>
</div>

<ul>
<li>실습을 위해 gazebo와 rqt를 실행합니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Terminal 1</span>
</span></span><span style="display:flex;"><span>ros2 launch src_gazebo empty_world.launch.py
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Terminal 2</span>
</span></span><span style="display:flex;"><span>rqt
</span></span></code></pre></div><ul>
<li>
<p>rqt 상단의 메뉴바에서 <strong>Plugins ⇒ Topics ⇒ Topic Monitor</strong>를 클릭합니다.
<img src="/kr/ros2_basic_foxy/images5/lec5_3.png?height=300px" alt="lec5_3.png"></p>
</li>
<li>
<p>topic monitor를 통해 현재 오가고 있는 topic들을 한눈에 볼 수 있습니다.
<img src="/kr/ros2_basic_foxy/images5/lec5_4.png?height=300px" alt="lec5_4.png"></p>
</li>
<li>
<p>이번에는 rqt 상단의 메뉴바에서 <strong>Plugins ⇒ Topics ⇒ Message Publisher</strong>를 클릭하고, <strong>+ 버튼</strong>을 눌러 publish를 원하는 topic을 추가합니다.</p>
</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_5.png?height=300px" alt="lec5_5.png"></p>
<ul>
<li><strong>Topic Publisher</strong>는 별도의 작업 없이 msg에 원하는 값을 채워 topic publish가 가능하게 해주는 툴입니다. 최종 publish를 위해 체크박스를 클릭하고, 원하는 값을 채워넣습니다.</li>
</ul>
<h3 id="ros-bridge">ROS Bridge</h3>
<blockquote>
<p>강의노트를 작성하고 있는 2023년 지금도 ROS 1으로 개발된 시스템에 종속성을 가진 기업들과 프로젝트들이 많습니다. ROS 1과 ROS 2를 같이 사용할 수는 없을까요? <strong>ros1 bridge</strong>를 실습해봅시다.</p>
</blockquote>
<ul>
<li>일전, ROS 1에서 사용하던 smb gazebo를 오랜만에 실행시켜봅시다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>roslaunch smb_gazebo smb_gazebo.launch
</span></span></code></pre></div><p><img src="/kr/ros2_basic_foxy/images5/lec5_6.png?height=300px" alt="lec5_6.png"></p>
<ul>
<li><strong>ros1 bridge</strong>를 통해 ROS 2 시스템에서 로봇을 제어해보겠습니다. 새로운 터미널을 열고, 초기 옵션 선택 시 3번을 선택하면 ros1 bridge가 실행됩니다. (이 동작은 사실 dynamic_bridge를 실행시키는 것입니다.)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install ros-foxy-ros1-bridge -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Terminal 1 - ros bridge</span>
</span></span><span style="display:flex;"><span>ros2 run ros1_bridge dynamic_bridge
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Terminal 2 - ros2 foxy</span>
</span></span><span style="display:flex;"><span>ros2 run teleop_twist_keyboard teleop_twist_keyboard
</span></span></code></pre></div><ul>
<li>ROS 2로 설정된 터미널에서 ROS 1으로 구동되고 있는 로봇을 조종할 수 있습니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/ros_bridge.gif?height=400px" alt="ros_bridge.gif"></p>
<ul>
<li>ros bridge가 있으니 ROS 2 개발을 굳이 하지 않아도 된다고 생각할 수 있습니다. 하지만 보안, 지연과 같은 ROS 1의 고질적인 문제들은 여전히 남아있게 되므로 프로젝트를 시작하는 단계라면, ROS 2로 모든 개발을 진행하시길 추천드립니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_7.png?height=200px" alt="lec5_7.png"></p>
<ul>
<li>image from : <a href="https://www.swri.org/industry/industrial-robotics-automation/blog/the-ros-1-vs-ros-2-transition">swri.org</a></li>
</ul>

<div class="notices tip" ><p>참고로, <code>/opt/ros/&lt;ros-version&gt;/setup.bash</code>는 ROS 시스템을 사용하기 위해서 필요한 설정이 담긴 파일입니다. 혹여나 galactic, humble과 같이 최신 버전을 사용하고 싶을 때 참고하시기 바랍니다.</p>
</div>

<blockquote>
<p>ROS 1과 ROS 2를 모두 관리하기에는 많은 노력이 필요하고, 원하는 기능이 모두 동작하지 않을 수 있습니다. 이전 버전 legacy가 있는 경우, 잘 판단하여 시스템을 유지/보수합시다.</p>
</blockquote>
<h3 id="my-gazebo-world">My Gazebo World</h3>
<blockquote>
<p>Topic의 응용으로 Gazebo를 사용하여 나만의 장애물을 만들고, 충돌을 회피하는 코드를 작성해보고자 합니다. 이를 위해 Gazebo의 Building Editor 사용법을 알려드리겠습니다.</p>
</blockquote>
<ul>
<li>gazebo를 실행시킨 뒤, 상단 Edit 옵션에서 Building Editor를 실행합니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/gz_building_editor.gif?height=400px" alt="gz_building_editor.gif"></p>
<ul>
<li>상단 모눈종이에 스케치를 통해 건물 벽을 생성할 수 있으며, 하단 view를 통해 실시간으로 업데이트되는 건물을 확인할 수 있습니다. 혹여 실수를 했거나, 보다 정확한 수치를 입력하고 싶은 경우, 모눈종이 위의 검은 선을 더블 클릭하면 사진과 같이 구체적인 설정을 변경할 수 있는 탭이 등장합니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_8.png?height=300px" alt="lec5_8.png"></p>
<ul>
<li>수정이 완료되었다면, 왼쪽 탭에서 door, stairs도 사용해보고, Texture도 입혀봅시다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_9.png?height=300px" alt="lec5_9.png"></p>
<ul>
<li>모든 작업을 마친 뒤, File 탭에서 Save As를 선택하여 완성한 물체를 저장합니다. (저는 wall 이라는 이름으로 저장해보겠습니다.)</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/gz_save_model.gif?height=400px" alt="gz_save_model.gif"></p>
<ul>
<li>저장된 폴더 내부는 다음과 같은 구조를 갖게 됩니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">├─</span>  wall
</span></span><span style="display:flex;"><span>   <span style="color:#960050;background-color:#1e0010">├──</span> model<span style="color:#f92672">.</span>config
</span></span><span style="display:flex;"><span>   <span style="color:#960050;background-color:#1e0010">└──</span> model<span style="color:#f92672">.</span>sdf
</span></span></code></pre></div><ul>
<li><strong>model.config</strong> : 해당 model의 이름, 작성자 등 기본적인 정보들이 기입됩니다.</li>
<li><strong>model.sdf</strong> : 실직적인 sdf 형식의 모델이 위치합니다.</li>
</ul>
<p>작성한 물체를 Gazebo에서 두고두고 사용하는 몇가지 방법들이 있습니다.</p>
<ol>
<li>GAZEBO_MODEL_PATH에 추가하기 ⇒ <strong>~/.gazebo/gui.ini</strong> 파일 내 model_paths에 building 폴더에 절대 경로를 추가합니다.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> gedit <span style="color:#f92672">~/.</span>gazebo<span style="color:#f92672">/</span>gui<span style="color:#f92672">.</span>ini
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[geometry]
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>y<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>[model_paths]
</span></span><span style="display:flex;"><span>filenames<span style="color:#f92672">=/</span>home<span style="color:#f92672">/</span>kimsooyoung<span style="color:#f92672">/&lt;</span>your<span style="color:#f92672">-</span>folder<span style="color:#f92672">-</span>location<span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="2">
<li>launch file에서 GAZEBO_MODEL_PATH 수정하기 ⇒ 대신 이렇게 하면 해당 launch file 사용 시에만 GAZEBO_MODEL_PATH가 반영됩니다.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;GAZEBO_MODEL_PATH&#39;</span> <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>environ:
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;GAZEBO_MODEL_PATH&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> gazebo_model_path
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;GAZEBO_MODEL_PATH&#39;</span>] <span style="color:#f92672">=</span> gazebo_model_path
</span></span></code></pre></div><ul>
<li>
<p>이제 Gazebo를 실행시키면, 사진과 같이 Insert 부분에 building이 추가되어있음을 확인 가능합니다. 이를 클릭 후 gazebo 환경으로 커서를 옮기면 원하는 위치에 wall을 위치시킬 수 있습니다.
<img src="/kr/ros2_basic_foxy/images5/lec5_10.png?height=300px" alt="lec5_10.png"></p>
</li>
<li>
<p>wall이 추가된 world는 별도로 저장해줘야 합니다. <strong>File ⇒ Save World As</strong>를 클릭하면 완성된 world 파일을 저장합시다.
<img src="/kr/ros2_basic_foxy/images5/lec5_11.png?height=200px" alt="lec5_11.png"></p>
</li>
</ul>
<blockquote>
<p>생성한 world 파일을 launch 파일로 실행해봅시다.</p>
</blockquote>
<ul>
<li>
<p>저장해두었던 Gazebo world 파일을 src_gazebo의 worlds 폴더에 위치시킵니다.
<img src="/kr/ros2_basic_foxy/images5/lec5_12.png?height=300px" alt="lec5_12.png"></p>
</li>
<li>
<p>launch 파일을 수정하여 새로운 world 파일의 위치를 전달합니다.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_launch_description</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># gazebo</span>
</span></span><span style="display:flex;"><span>    pkg_gazebo_ros <span style="color:#f92672">=</span> FindPackageShare(package<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gazebo_ros&#39;</span>)<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;gazebo_ros&#39;</span>)
</span></span><span style="display:flex;"><span>    pkg_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(get_package_share_directory(<span style="color:#e6db74">&#39;src_gazebo&#39;</span>))
</span></span><span style="display:flex;"><span>    world_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(pkg_path, <span style="color:#e6db74">&#39;worlds&#39;</span>, <span style="color:#e6db74">&#39;여러분의-world-file.world&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Start Gazebo server</span>
</span></span><span style="display:flex;"><span>    start_gazebo_server_cmd <span style="color:#f92672">=</span> IncludeLaunchDescription(
</span></span><span style="display:flex;"><span>        PythonLaunchDescriptionSource(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(pkg_gazebo_ros, <span style="color:#e6db74">&#39;launch&#39;</span>, <span style="color:#e6db74">&#39;gzserver.launch.py&#39;</span>)),
</span></span><span style="display:flex;"><span>        launch_arguments<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;world&#39;</span>: world_path}<span style="color:#f92672">.</span>items()
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><ul>
<li>package를 빌드하고, gazebo를 다시 실행해봅시다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>colcon build <span style="color:#f92672">--</span>packages<span style="color:#f92672">-</span>select src_gazebo
</span></span><span style="display:flex;"><span>source install<span style="color:#f92672">/</span>local_setup<span style="color:#f92672">.</span>bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ros2 launch src_gazebo empty_world<span style="color:#f92672">.</span>launch<span style="color:#f92672">.</span>py
</span></span></code></pre></div><ul>
<li>제작한 world와 로봇이 함께 등장하는 것을 확인할 수 있습니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_13.png?height=300px" alt="lec5_13.png"></p>

<div class="notices note" ><p>최대한 여러분들만의 장애물을 만들어보시고, 혹시나 이 과정에서 도저히 모르겠는 오류가 발생했거나, 시간이 없는 경우, 우선 제가 제작한 world와 launch file을 사용하도록 합니다. ⇒ <code>ros2 launch src_gazebo wall_world.launch.py</code></p>
</div>

<h2 id="ros-2-topic-프로그래밍">ROS 2 Topic 프로그래밍</h2>
<h3 id="example1---cmd_vel-publish">example1 - cmd_vel publish</h3>
<ul>
<li>준비된 예시를 우선 실행해봅시다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Terminal 1</span>
</span></span><span style="display:flex;"><span>ros2 launch src_gazebo empty_world<span style="color:#f92672">.</span>launch<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Terminal 2</span>
</span></span><span style="display:flex;"><span>cd <span style="color:#f92672">~/</span>ros2_ws
</span></span><span style="display:flex;"><span>colcon build <span style="color:#f92672">--</span>packages<span style="color:#f92672">-</span>select py_topic_tutorial
</span></span><span style="display:flex;"><span>source install<span style="color:#f92672">/</span>local_setup<span style="color:#f92672">.</span>bash
</span></span><span style="display:flex;"><span>ros2 run py_topic_tutorial topic_pub_node
</span></span></code></pre></div><ul>
<li>로봇이 원을 그리며 움직이기 시작합니다. ROS 1 강의를 완료하였다면 어떻게 구현하였을지 아시겠지요?</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/circle_src.gif?height=400px" alt="circle_src.gif"></p>
<ul>
<li>코드를 살펴보겠습니다 - 시작으로, 필요한 파이썬 패키지들을 import 합니다. ROS 2에서 파이썬 프로그래밍을 하기 위해서는 rclpy를 import 해야 합니다. 더불어, <strong>Twist</strong>를 import하는 문법도 눈여겨봅시다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> geometry_msgs.msg <span style="color:#f92672">import</span> Twist
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> rclpy
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> rclpy.node <span style="color:#f92672">import</span> Node
</span></span></code></pre></div><ul>
<li>핵심이 되는 <strong>TwistPubNode</strong> 클래스의 생성자부터 살펴보겠습니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TwistPubNode</span>(Node):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__(<span style="color:#e6db74">&#39;twist_pub_node&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>get_logger()<span style="color:#f92672">.</span>info(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;TwistPubNode Created at </span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>get_clock()<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>to_msg()<span style="color:#f92672">.</span>sec<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># self.twist_publisher = self.create_publisher(Twist, &#34;twist_topic&#34;, 10)</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>twist_publisher <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>create_publisher(Twist, <span style="color:#e6db74">&#39;/cmd_vel&#39;</span>, <span style="color:#ae81ff">10</span>)
</span></span></code></pre></div><p><strong>create_publisher</strong>는 topic publisher를 생성하는 함수로 3개의 매개변수를 받으며 각각에 대한 설명은 다음과 같습니다.</p>
<ul>
<li><strong>message type</strong> : Topic 통신에 사용될 msg Type 입니다.</li>
<li><strong>topic name</strong> : 사용할 Topic 이름을 지정합니다. (이 이름을 잘못 설정하면 존재하지 않는 topic에 Publish하는 오류 상황이 발생하니 주의합니다.)</li>
<li><strong>queue_size</strong> : 대기열의 크기라고 이해하시면 좋습니다.</li>
<li><strong>timer callback</strong>에서 publish가 이루어집니다. 생성한 publisher에서 publish 함수를 사용하며 매개변수로 message가 전달됩니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>create_timer(<span style="color:#ae81ff">0.2</span>, self<span style="color:#f92672">.</span>timer_callback)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">timer_callback</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Timer will run this function periodically.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        msg <span style="color:#f92672">=</span> Twist()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Fill in msg with compatible values</span>
</span></span><span style="display:flex;"><span>        msg<span style="color:#f92672">.</span>linear<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>        msg<span style="color:#f92672">.</span>angular<span style="color:#f92672">.</span>z <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>twist_publisher<span style="color:#f92672">.</span>publish(msg)
</span></span></code></pre></div><h3 id="example2---scan-subscription">example2 - scan subscription</h3>
<ul>
<li>이번 예시는 라이다 데이터를 다뤄보고자 합니다. 명령어를 실행해봅시다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Terminal 1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> ros2 launch src_gazebo empty_world<span style="color:#f92672">.</span>launch<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Terminal 2</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> ros2 run py_topic_tutorial topic_sub_node
</span></span><span style="display:flex;"><span>[INFO] [<span style="color:#ae81ff">1672494602.141200628</span>] [scan_sub_node]:
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">0</span>] : inf
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">30</span>] : inf
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">60</span>] : <span style="color:#ae81ff">0.7975894212722778</span>
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">90</span>] : inf
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">119</span>] : inf
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p>예시를 실행시킨 상황에서 Gazebo 상의 로봇 주변으로 물체를 등장시켜봅시다.</p>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_14.png?height=300px" alt="lec5_14.png"></p>
<p>scan data의 ranges는 사진과 같은 거리 데이터를 담고 있답니다.</p>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_15.png?height=300px" alt="lec5_15.png"></p>
<ul>
<li>코드를 살펴봅시다. 이번에는 <a href="http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/LaserScan.html">sensor_msgs/msg/LaserScan</a>이 사용되었습니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> rclpy
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> rclpy.node <span style="color:#f92672">import</span> Node
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sensor_msgs.msg <span style="color:#f92672">import</span> LaserScan
</span></span></code></pre></div><ul>
<li>ScanSubNode 클래스의 생성자에서는 scan topic의 subscriber가 생성됩니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ScanSubNode</span>(Node):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__(<span style="color:#e6db74">&#39;scan_sub_node&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        queue_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>  <span style="color:#75715e"># Queue Size</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>pose_subscriber <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>create_subscription(
</span></span><span style="display:flex;"><span>            LaserScan, <span style="color:#e6db74">&#39;scan&#39;</span>, self<span style="color:#f92672">.</span>sub_callback, queue_size
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><p><strong>create_subscription</strong>은 4개의 매개변수를 받으며 각각에 대한 설명은 다음과 같습니다.</p>
<ul>
<li><strong>Message Type</strong> : Topic 통신에 사용될 msg Type 입니다.</li>
<li><strong>topic name</strong> : 데이터를 Subscribe할 Topic의 이름을 지정합니다. (이 이름을 잘못 설정하면 아무것도 publish하고 있지 않는 topic을 마냥 기다리고 있게 되는 상황이 발생할 것입니다.)</li>
<li><strong>subscribe callback</strong> : 데이터가 전달될 때마다 실행되는 callback 함수로, 전달된 데이터를 통해 실행할 작업이 이 함수 안에 구현됩니다.</li>
<li><strong>queue_size</strong> : create_publisher때와 마찬가지로, 대기열의 크기라고 이해하시면 좋습니다.</li>
</ul>
<p>sub_callback의 첫번쨰 매개변수는 항상 topic message data가 됩니다. 해당 message에서 원하는 데이터만 추출한 다음, logger를 통해 콘솔 출력을 진행합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sub_callback</span>(self, msg):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Timer will run this function periodically.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>get_logger()<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39; </span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">msg.ranges[0] : </span><span style="color:#e6db74">{</span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">msg.ranges[30] : </span><span style="color:#e6db74">{</span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">30</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">msg.ranges[60] : </span><span style="color:#e6db74">{</span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">60</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">msg.ranges[90] : </span><span style="color:#e6db74">{</span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">90</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">msg.ranges[119] : </span><span style="color:#e6db74">{</span>msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">119</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#e6db74">        &#39;</span>)
</span></span></code></pre></div><h3 id="example3---parking">example3 - parking</h3>
<ul>
<li>이번 예시를 실행하기 전에, empty_world.launch.py를 수정해야 합니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#75715e"># gazebo</span>
</span></span><span style="display:flex;"><span>    pkg_gazebo_ros <span style="color:#f92672">=</span> FindPackageShare<span style="color:#f92672">(</span>package<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gazebo_ros&#39;</span><span style="color:#f92672">)</span>.find<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;gazebo_ros&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    pkg_path <span style="color:#f92672">=</span> os.path.join<span style="color:#f92672">(</span>get_package_share_directory<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;src_gazebo&#39;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># world_path = os.path.join(pkg_path, &#39;worlds&#39;, &#39;empty_world.world&#39;)</span>
</span></span><span style="display:flex;"><span>    world_path <span style="color:#f92672">=</span> os.path.join<span style="color:#f92672">(</span>pkg_path, <span style="color:#e6db74">&#39;worlds&#39;</span>, <span style="color:#e6db74">&#39;wall_world.world&#39;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><ul>
<li>물체와 충돌하기 전까지 로봇을 움직이다가 일정 거리 내 벽이 검출되면 자동으로 멈추는 예시입니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Terminal 1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> ros2 launch src_gazebo empty_world<span style="color:#f92672">.</span>launch<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Terminal 2</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> ros2 run py_topic_tutorial parking_node
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>[INFO] [<span style="color:#ae81ff">1672563255.067421128</span>] [parking_node]: Distance <span style="color:#f92672">from</span> Front Object : <span style="color:#ae81ff">0.6280616521835327</span>
</span></span><span style="display:flex;"><span>[INFO] [<span style="color:#ae81ff">1672563255.173734128</span>] [parking_node]: Distance <span style="color:#f92672">from</span> Front Object : <span style="color:#ae81ff">0.5546504259109497</span>
</span></span><span style="display:flex;"><span>[INFO] [<span style="color:#ae81ff">1672563255.281276729</span>] [parking_node]: Distance <span style="color:#f92672">from</span> Front Object : <span style="color:#ae81ff">0.5124648809432983</span>
</span></span><span style="display:flex;"><span>[INFO] [<span style="color:#ae81ff">1672563255.389067729</span>] [parking_node]: <span style="color:#f92672">====</span> Parking Done<span style="color:#960050;background-color:#1e0010">!!!</span> <span style="color:#f92672">====</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p><img src="/kr/ros2_basic_foxy/images5/parking.gif?height=400px" alt="parking.gif"></p>
<p>이 기능을 구현하기 위해서는 Topic Publish와 Subscribe가 모두 필요합니다.</p>
<ul>
<li><strong>/cmd_vel topic publish</strong></li>
<li><strong>/scan topic subscribe</strong></li>
</ul>
<p>⇒ 따라서, Node의 생성자에서도 Publisher와 Subscriber를 모두 생성합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ParkingNode</span>(Node):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span>__init__(<span style="color:#e6db74">&#39;parking_node&#39;</span>)
</span></span><span style="display:flex;"><span>        queue_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>  <span style="color:#75715e"># Queue Size</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>twist_publisher <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>create_publisher(Twist, <span style="color:#e6db74">&#39;cmd_vel&#39;</span>, queue_size)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>scan_subscriber <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>create_subscription(
</span></span><span style="display:flex;"><span>            LaserScan, <span style="color:#e6db74">&#39;scan&#39;</span>, self<span style="color:#f92672">.</span>sub_callback, queue_size
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><ul>
<li><strong>sub_callback</strong>에서는 전방 (msg.ranges[60]) 물체와의 거리를 탐지하고, 이 거리가 0.5m 이하가 되면 정지 topic을 publish 합니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sub_callback</span>(self, msg):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        twist_msg <span style="color:#f92672">=</span> Twist()
</span></span><span style="display:flex;"><span>        distance_forward <span style="color:#f92672">=</span> msg<span style="color:#f92672">.</span>ranges[<span style="color:#ae81ff">60</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> distance_forward <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.5</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>get_logger()<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Distance from Front Object : </span><span style="color:#e6db74">{</span>distance_forward<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>            twist_msg<span style="color:#f92672">.</span>linear<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>twist_publisher<span style="color:#f92672">.</span>publish(twist_msg)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>get_logger()<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#39;==== Parking Done!!! ====</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>            twist_msg<span style="color:#f92672">.</span>linear<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>twist_publisher<span style="color:#f92672">.</span>publish(twist_msg)
</span></span></code></pre></div><h3 id="cv-2-and-ros-2">CV 2 and ROS 2</h3>
<blockquote>
<p>Topic과 ROS 2 Bag을 사용한 예시를 실행해보고자 합니다.</p>
</blockquote>
<p>이번 실습을 위해 제가 미리 준비한 데이터셋을 제공드리니, 기억하기 쉬운 위치에 다운받아 주세요.</p>
<p>📁 <a href="https://drive.google.com/file/d/1Ue_mDFaPoKW2LA8mD9eGFAeJD5IVc3K-/view?usp=sharing">quadrupped_train.zip</a></p>

<div class="notices tip" ><p>Windows + WSL2 유저의 경우 <code>explorer.exe</code> 명령어를 통해 파일 탐색기를 열 수 있습니다.</p>
</div>

<ul>
<li>준비된 예시를 실행해봅시다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 예제 실행 준비</span>
</span></span><span style="display:flex;"><span>sudo apt install ros-foxy-rosbag2
</span></span><span style="display:flex;"><span>cd ~/ros2_ws
</span></span><span style="display:flex;"><span>colcon build --packages-select py_cv_tutorial
</span></span><span style="display:flex;"><span>source install/local_setup.bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 터미널 1 – 데이터 위치로 이동하여 ros2 bag 실행</span>
</span></span><span style="display:flex;"><span>cd &lt;데이터를 저장한 위치&gt;
</span></span><span style="display:flex;"><span>ros2 bag play quadrupped_train.bag_0.db3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 터미널 2 – image_view 실행</span>
</span></span><span style="display:flex;"><span>ros2 run rqt_image_view rqt_image_view
</span></span></code></pre></div><ul>
<li>사진과 같이 기차 선로 모습이 보인다면 성공입니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_16.png?height=300px" alt="lec5_16.png"></p>
<p>해당 데이터셋은 <strong>기차 선로에서 주행하는 4족 보행 로봇</strong>으로부터 취득한 것입니다. 기차 선로는 주기적으로 관리가 필요하며, 길고 긴 선로를 로봇이 자동으로 검사해준다면 아주 유용할 것입니다. 이러한 상상을 해보면서 실습에 임해봅시다.</p>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_17.png?height=300px" alt="lec5_17.png"></p>
<h3 id="example1---cv-bridge">Example1 - CV Bridge</h3>
<blockquote>
<p>이미지를 다루기 위한 오픈소스 라이브러리인 <strong>OpenCV</strong>를 사용해보려 합니다. 준비된 예시와, ros2 bag 파일을 실행하면 cv2.imshow를 통해 연속된 이미지를 확인할 수 있습니다.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 터미널 1</span>
</span></span><span style="display:flex;"><span>$ cd &lt;bag 파일 위치&gt;
</span></span><span style="display:flex;"><span>$ ros2 bag play quadruped_train.bag_0.db3
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>1667077909.362223100<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>rosbag2_storage<span style="color:#f92672">]</span>: Opened database <span style="color:#e6db74">&#39;quadrupped_train/quadrupped_train.bag_0.db3&#39;</span> <span style="color:#66d9ef">for</span> READ_ONLY.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 터미널 2</span>
</span></span><span style="display:flex;"><span>$ ros2 run py_cv_tutorial img_sub
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>1667077909.613586300<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>image_subscriber<span style="color:#f92672">]</span>: Receiving video frame
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>1667077910.934147000<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>image_subscriber<span style="color:#f92672">]</span>: Receiving video frame
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><ul>
<li>OpenCV에서는 CV::Mat 이라는 특정 타입을 사용합니다. 이를 ROS 2의 Topic Message로 변환하기 위해서 <strong>CV Bridge</strong>라는 것을 사용합니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> cv_bridge <span style="color:#f92672">import</span> CvBridge <span style="color:#75715e"># Package to convert between ROS and OpenCV Images</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cv2 <span style="color:#75715e"># OpenCV library</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ImageSubscriber</span>(Node):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Used to convert between ROS and OpenCV images</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>br <span style="color:#f92672">=</span> CvBridge()
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listener_callback</span>(self, data):
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Convert ROS Image message to OpenCV image</span>
</span></span><span style="display:flex;"><span>        current_frame <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>br<span style="color:#f92672">.</span>imgmsg_to_cv2(data, <span style="color:#e6db74">&#34;bgr8&#34;</span>)
</span></span><span style="display:flex;"><span>        edge_frame <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>hough_transform(current_frame)
</span></span></code></pre></div><ul>
<li>imgmsg_to_cv2를 통해 CV::Mat으로 변환된 이미지 데이터를 OpenCV의 다양한 기능들과 함께 사용할 수 있습니다. 코드의 imshow 부분을 바꿔서 이미지 처리를 적용해 봅시다. 직선을 검출하는 알고리즘이며, 매개변수의 최적화를 통해 선로를 인지할 수 있습니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_18.png?height=300px" alt="lec5_18.png"></p>
<p>직선 검출을 위해 사용된 OpenCV 기능들은 아래와 같습니다. 로직을 업그레이드하여 여러분만의 선로 검출 알고리즘을 만들어 보세요!</p>
<ul>
<li><a href="https://opencv-python.readthedocs.io/en/latest/doc/11.imageSmoothing/imageSmoothing.html">cv2.GaussianBlur</a></li>
<li><a href="https://www.geeksforgeeks.org/draw-a-filled-polygon-using-the-opencv-function-fillpoly/">cv2.fillPoly</a> / <a href="https://opencv-python.readthedocs.io/en/latest/doc/07.imageArithmetic/imageArithmetic.html">cv2.bitwise_and</a> ROI 설정</li>
<li><a href="https://opencv-python.readthedocs.io/en/latest/doc/25.imageHoughLineTransform/imageHoughLineTransform.html">cv2.HoughLinesP</a></li>
</ul>
<h3 id="rosbag-to-img">rosbag to img</h3>
<blockquote>
<p>컴퓨터 비전만으로 완벽한 선로 인식을 구현하기는 너무나 힘듭니다. 딥러닝을 사용해서 이를 극복할 수 있을 것이며, 데이터셋의 제작을 위해 rosbag 데이터에서 이미지를 추출하는 예시를 준비하였습니다.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ros2 run py_cv_tutorial rosbag2_to_timedimg
</span></span><span style="display:flex;"><span>/home/kimsooyoung/djhrd_ws/quadrupped_train/quadrupped_train.bag_0.db3
</span></span><span style="display:flex;"><span>saved: color_1666796292992515592.png
</span></span><span style="display:flex;"><span>saved: color_1666796293035428479.png
</span></span><span style="display:flex;"><span>saved: color_1666796293079139778.png
</span></span><span style="display:flex;"><span>saved: color_1666796293120768031.png
</span></span></code></pre></div><ul>
<li>예제 실행 전 main 함수에서 bag 파일의 위치를 여러분의 것으로 수정해야 합니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(args<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Change below roots to your ros2 bag locations</span>
</span></span><span style="display:flex;"><span>    ROOT_DIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/home/kimsooyoung/djhrd_ws/quadrupped_train&#34;</span>
</span></span><span style="display:flex;"><span>    FILENAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/quadrupped_train.bag_0.db3&#34;</span>
</span></span><span style="display:flex;"><span>    DESCRIPTION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;color_&#34;</span>
</span></span></code></pre></div><ul>
<li>예제 실행 후 사진과 같이 기차 생성된 이미지들이 보인다면 성공입니다.</li>
</ul>
<p><img src="/kr/ros2_basic_foxy/images5/lec5_19.png?height=300px" alt="lec5_19.png"></p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/kr/ros2_basic_foxy/lecture4/" title="Lecture4 - ROS 2 Node C&#43;&#43; Programming"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/kr/ros2_basic_foxy/lecture6/" title="Lecture6 - ROS 2 Service and Examples" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1682980326"></script>
    <script src="/js/perfect-scrollbar.min.js?1682980326"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1682980326"></script>
    <script src="/js/jquery.sticky.js?1682980326"></script>
    <script src="/js/featherlight.min.js?1682980326"></script>
    <script src="/js/highlight.pack.js?1682980326"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1682980326"></script>
    <script src="/js/learn.js?1682980326"></script>
    <script src="/js/hugo-learn.js?1682980326"></script>
    
        
            <script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

